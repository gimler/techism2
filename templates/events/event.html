{% extends "base.html" %}

{% block head %}
  <link type="text/css" href="/static/jquery/css/custom-theme/jquery-ui-1.8.5.custom.css" media="screen" rel="stylesheet"/>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script type="text/javascript">
  var geocoder;
  var map;
  
  function initialize() {
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(48.13788,11.575953);
    var myOptions = {
      zoom: 15,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);  
  }
  google.maps.event.addDomListener(window, 'load', initialize);
  
  function displayLocation(){
    var street = document.getElementById("id_{{ form.location_street.html_name }}").value;
    var city = document.getElementById("id_{{ form.location_city.html_name }}").value;
    var location = street +","+city+","+ "Bayern";
    
    if (geocoder) {
      geocoder.geocode( { 'address': location}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          map.setCenter(results[0].geometry.location);
          var marker = new google.maps.Marker({
              map: map, 
              position: results[0].geometry.location,
              draggable: true
          });
        } else {
          document.getElementById("map_error").innerHTML="Geocode war nicht erfolgreich: " + status;
        }
      });
    }
  }
</script>
{% endblock %}                                               


{% block content %}
<section id="content">
	
    <section id="create">
	
	{% if not user.is_authenticated %}
    	<div id="message">
			<p>Bitte beachten!</p>
			<ul>
			<li>Unser Fokus sind <strong>Treffen</strong>, <strong>Vorträge</strong> und <strong>Konferenzen</strong> aus dem <strong>Open Source</strong>, <strong>Usergroup</strong> und <strong>DIY</strong> Umfeld</li>
			<li>Rein kommerziell motivierte Veranstalungen, ganz besonders welche mit Teilnahmebeschränkungen und Kosten >100€ werden in der Regel nicht aufgenommen.</li>
			<li>Neue Events werden erst nach einem Review freigeschaltet. Dies ist leider nötig um "Spam"-Listungen zu vermeiden.</li> 
			<li>Nachdem der erfolgreichen Eintragung von min. 5 Events (du musst dafür angemeldet sein), entfällt der Review Prozess für dich (natürlich nur solange kein Missbrauch damit stattfindet)</li>			
			<li>Noch Fragen? @Techism oder an Fragen@Techism.de</li>
			</ul>
			<p>Eine Anmeldung ist optional und ermöglichst das nachträgliche Editieren und Löschen deiner angelegten Events - <a href="/accounts/login/">Hier anmelden</a></p>
		</div>
    	{% endif %}
    	
    	  <form action="" method="post">    
    	{% csrf_token %}
    	{{ form.id }}
    	
		<section id="what">
			<h3>Was</h3>
			    	{{ form.title.errors }}
			    	{{ form.title.label_tag }} {{ form.title }}<br>
			    	
			    	{{ form.url.errors }}
			    	{{ form.url.label_tag }} {{ form.url }}<br>
			    	
			    	{{ form.description.errors }}
			    	{{ form.description.label_tag }} {{ form.description  }}<br>
			    	
			    	{{ form.tags.errors }}
			    	{{ form.tags.label_tag }} {{ form.tags }}<br><br> 
		</section>
	 	<section id="when">   
			<h3>Wann</h3>

    	{{ form.date_time_begin.errors }}
    	{{ form.date_time_begin.label_tag }} {{ form.date_time_begin }}<br>
    	
    	{{ form.date_time_end.errors }}
    	{{ form.date_time_end.label_tag }} {{ form.date_time_end }}<br>

		</section>     	
	 	<section id="where">
		<h3>Wo</h3> 
    	<b>{{ form.location.label_tag }}</b><br>
    	vorhandene  auswählen: {{ form.location }}<br>
    	oder neue anlegen:<br>
    	
    	{{ form.location_name.errors }}
    	{{ form.location_name.label_tag }} {{ form.location_name }}<br>
    	
    	{{ form.location_street.errors }}
    	{{ form.location_street.label_tag }} {{ form.location_street }}<br>
    	
    	{{ form.location_city.errors }}
    	{{ form.location_city.label_tag }} {{ form.location_city }}<br>
    	<input onclick="displayLocation()" type="button" value="Adresse in Google Maps anzeigen"><div id="map_error"></div>
    	<div id="map_canvas" style="height: 400px; width: 600px"></div>
    	
		<input type="submit" value="{{ button_label }}" />
    	</form>
    	</section>  
    	
		</section>
    	{% endblock %}


{% block scripts %}
  <script type="text/javascript">
     $(function() {
         $("#id_date_time_begin_0").datepicker({ dateFormat: 'yy-mm-dd' });
         $("#id_date_time_end_0").datepicker({ dateFormat: 'yy-mm-dd' });
     });
  </script>
{% endblock %}
